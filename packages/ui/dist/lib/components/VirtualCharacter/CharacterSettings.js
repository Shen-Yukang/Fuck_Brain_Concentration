import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useState, useEffect } from 'react';
import { useStorage } from '@extension/shared';
import { characterStorage, chatHistoryStorage } from '@extension/storage';
export const CharacterSettings = ({ className }) => {
    const config = useStorage(characterStorage);
    const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
    const [totalMessages, setTotalMessages] = useState(0);
    // Load chat statistics
    useEffect(() => {
        loadChatStats();
    }, []);
    const loadChatStats = async () => {
        try {
            const history = await chatHistoryStorage.get();
            setTotalMessages(history.totalMessages);
        }
        catch (error) {
            console.error('Error loading chat stats:', error);
        }
    };
    const handleToggleEnabled = async () => {
        await characterStorage.enable(!config.enabled);
    };
    const handleAppearanceChange = async (field, value) => {
        await characterStorage.updateAppearance({ [field]: value });
    };
    const handleBehaviorChange = async (field, value) => {
        await characterStorage.updateBehavior({ [field]: value });
    };
    const handlePersonalityChange = async (field, value) => {
        await characterStorage.updatePersonality({ [field]: value });
    };
    const handleClearHistory = async () => {
        if (confirm('确定要清除所有聊天记录吗？此操作不可撤销。')) {
            await chatHistoryStorage.clearHistory();
            setTotalMessages(0);
        }
    };
    return (_jsxs("div", { className: `space-y-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg ${className}`, children: [_jsx("h3", { className: "text-lg font-semibold text-gray-900 dark:text-white", children: "\uD83E\uDD16 \u865A\u62DF\u52A9\u624B\u8BBE\u7F6E" }), _jsxs("div", { className: "flex items-center justify-between", children: [_jsx("label", { className: "text-sm font-medium text-gray-700 dark:text-gray-300", children: "\u542F\u7528\u865A\u62DF\u52A9\u624B" }), _jsx("button", { onClick: handleToggleEnabled, className: `relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${config.enabled ? 'bg-blue-600' : 'bg-gray-200 dark:bg-gray-600'}`, children: _jsx("span", { className: `inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${config.enabled ? 'translate-x-6' : 'translate-x-1'}` }) })] }), config.enabled && (_jsxs("div", { className: "space-y-4", children: [_jsxs("div", { className: "space-y-3", children: [_jsx("h4", { className: "text-sm font-medium text-gray-700 dark:text-gray-300", children: "\u5916\u89C2\u8BBE\u7F6E" }), _jsxs("div", { children: [_jsx("label", { className: "block text-xs text-gray-600 dark:text-gray-400 mb-1", children: "\u89D2\u8272\u98CE\u683C" }), _jsxs("select", { value: config.appearance.style, onChange: (e) => handleAppearanceChange('style', e.target.value), className: "w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white", children: [_jsx("option", { value: "cute-mascot", children: "\u53EF\u7231\u5409\u7965\u7269" }), _jsx("option", { value: "simple-geometric", children: "\u7B80\u7EA6\u51E0\u4F55" }), _jsx("option", { value: "minimalist-icon", children: "\u6781\u7B80\u56FE\u6807" })] })] }), _jsxs("div", { children: [_jsx("label", { className: "block text-xs text-gray-600 dark:text-gray-400 mb-1", children: "\u5927\u5C0F" }), _jsxs("select", { value: config.appearance.size, onChange: (e) => handleAppearanceChange('size', e.target.value), className: "w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white", children: [_jsx("option", { value: "small", children: "\u5C0F" }), _jsx("option", { value: "medium", children: "\u4E2D" }), _jsx("option", { value: "large", children: "\u5927" })] })] }), _jsxs("div", { children: [_jsx("label", { className: "block text-xs text-gray-600 dark:text-gray-400 mb-1", children: "\u5C4F\u5E55\u4F4D\u7F6E" }), _jsxs("select", { value: config.appearance.position, onChange: (e) => handleAppearanceChange('position', e.target.value), className: "w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white", children: [_jsx("option", { value: "bottom-right", children: "\u53F3\u4E0B\u89D2" }), _jsx("option", { value: "bottom-left", children: "\u5DE6\u4E0B\u89D2" }), _jsx("option", { value: "top-right", children: "\u53F3\u4E0A\u89D2" }), _jsx("option", { value: "top-left", children: "\u5DE6\u4E0A\u89D2" })] })] })] }), _jsxs("div", { className: "space-y-3", children: [_jsx("h4", { className: "text-sm font-medium text-gray-700 dark:text-gray-300", children: "\u4E2A\u6027\u8BBE\u7F6E" }), _jsxs("div", { children: [_jsx("label", { className: "block text-xs text-gray-600 dark:text-gray-400 mb-1", children: "\u52A9\u624B\u540D\u79F0" }), _jsx("input", { type: "text", value: config.personality.name, onChange: (e) => handlePersonalityChange('name', e.target.value), className: "w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white", placeholder: "\u7ED9\u4F60\u7684\u52A9\u624B\u8D77\u4E2A\u540D\u5B57" })] }), _jsxs("div", { children: [_jsx("label", { className: "block text-xs text-gray-600 dark:text-gray-400 mb-1", children: "\u6027\u683C\u7C7B\u578B" }), _jsxs("select", { value: config.personality.personality, onChange: (e) => handlePersonalityChange('personality', e.target.value), className: "w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white", children: [_jsx("option", { value: "friendly", children: "\u53CB\u597D" }), _jsx("option", { value: "professional", children: "\u4E13\u4E1A" }), _jsx("option", { value: "encouraging", children: "\u9F13\u52B1" }), _jsx("option", { value: "playful", children: "\u6D3B\u6CFC" }), _jsx("option", { value: "custom", children: "\u81EA\u5B9A\u4E49" })] })] }), _jsxs("div", { children: [_jsx("label", { className: "block text-xs text-gray-600 dark:text-gray-400 mb-1", children: "\u56DE\u5E94\u98CE\u683C" }), _jsxs("select", { value: config.personality.responseStyle, onChange: (e) => handlePersonalityChange('responseStyle', e.target.value), className: "w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white", children: [_jsx("option", { value: "brief", children: "\u7B80\u6D01" }), _jsx("option", { value: "detailed", children: "\u8BE6\u7EC6" }), _jsx("option", { value: "conversational", children: "\u5BF9\u8BDD\u5F0F" })] })] })] }), _jsxs("div", { className: "space-y-3", children: [_jsxs("button", { onClick: () => setIsAdvancedOpen(!isAdvancedOpen), className: "flex items-center justify-between w-full text-sm font-medium text-gray-700 dark:text-gray-300", children: [_jsx("span", { children: "\u9AD8\u7EA7\u8BBE\u7F6E" }), _jsx("span", { className: `transform transition-transform ${isAdvancedOpen ? 'rotate-180' : ''}`, children: "\u25BC" })] }), isAdvancedOpen && (_jsxs("div", { className: "space-y-3 pl-4 border-l-2 border-gray-200 dark:border-gray-600", children: [_jsxs("div", { className: "space-y-2", children: [_jsxs("div", { className: "flex items-center justify-between", children: [_jsx("label", { className: "text-xs text-gray-600 dark:text-gray-400", children: "\u7A7A\u95F2\u52A8\u753B" }), _jsx("input", { type: "checkbox", checked: config.behavior.idleAnimations, onChange: (e) => handleBehaviorChange('idleAnimations', e.target.checked), className: "rounded" })] }), _jsxs("div", { className: "flex items-center justify-between", children: [_jsx("label", { className: "text-xs text-gray-600 dark:text-gray-400", children: "\u4E3B\u52A8\u804A\u5929" }), _jsx("input", { type: "checkbox", checked: config.behavior.proactiveChat, onChange: (e) => handleBehaviorChange('proactiveChat', e.target.checked), className: "rounded" })] }), _jsxs("div", { className: "flex items-center justify-between", children: [_jsx("label", { className: "text-xs text-gray-600 dark:text-gray-400", children: "\u4E13\u6CE8\u6A21\u5F0F\u96C6\u6210" }), _jsx("input", { type: "checkbox", checked: config.behavior.focusModeIntegration, onChange: (e) => handleBehaviorChange('focusModeIntegration', e.target.checked), className: "rounded" })] }), _jsxs("div", { className: "flex items-center justify-between", children: [_jsx("label", { className: "text-xs text-gray-600 dark:text-gray-400", children: "\u4E0A\u4E0B\u6587\u63D0\u793A" }), _jsx("input", { type: "checkbox", checked: config.behavior.contextualTips, onChange: (e) => handleBehaviorChange('contextualTips', e.target.checked), className: "rounded" })] })] }), _jsxs("div", { children: [_jsx("label", { className: "block text-xs text-gray-600 dark:text-gray-400 mb-1", children: "\u4EA4\u4E92\u9891\u7387" }), _jsxs("select", { value: config.behavior.interactionFrequency, onChange: (e) => handleBehaviorChange('interactionFrequency', e.target.value), className: "w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white", children: [_jsx("option", { value: "low", children: "\u4F4E" }), _jsx("option", { value: "medium", children: "\u4E2D" }), _jsx("option", { value: "high", children: "\u9AD8" })] })] })] }))] }), _jsxs("div", { className: "space-y-2 pt-4 border-t border-gray-200 dark:border-gray-600", children: [_jsx("h4", { className: "text-sm font-medium text-gray-700 dark:text-gray-300", children: "\u7EDF\u8BA1\u4FE1\u606F" }), _jsxs("div", { className: "text-xs text-gray-600 dark:text-gray-400", children: ["\u603B\u6D88\u606F\u6570: ", totalMessages] }), _jsx("button", { onClick: handleClearHistory, className: "text-xs text-red-600 dark:text-red-400 hover:underline", children: "\u6E05\u9664\u804A\u5929\u8BB0\u5F55" })] })] }))] }));
};
